"use strict";
/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdatethree"]("frontend",{

/***/ "./src/frontend/stores/userStore.js":
/*!******************************************!*\
  !*** ./src/frontend/stores/userStore.js ***!
  \******************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   useUserStore: function() { return /* binding */ useUserStore; }\n/* harmony export */ });\n/* harmony import */ var core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! core-js/modules/es.array.push.js */ \"./node_modules/core-js/modules/es.array.push.js\");\n/* harmony import */ var core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var pinia__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! pinia */ \"./node_modules/pinia/dist/pinia.mjs\");\n/* harmony import */ var axios__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! axios */ \"./node_modules/axios/lib/axios.js\");\n/* harmony import */ var _frontend_router_index_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/frontend/router/index.js */ \"./src/frontend/router/index.js\");\n/* harmony import */ var _frontend_stores_selectionStore_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/frontend/stores/selectionStore.js */ \"./src/frontend/stores/selectionStore.js\");\n\n\n\n\n\nconst useUserStore = (0,pinia__WEBPACK_IMPORTED_MODULE_3__.defineStore)('main', {\n  state: () => ({\n    metaKey: 'user_meta_data',\n    isAuthenticated: false,\n    errorMessage: '',\n    userData: {}\n  }),\n  actions: {\n    checkAuth() {\n      const isAuthenticated = localStorage.getItem('isAuthenticated');\n      if (isAuthenticated === 'true') {\n        this.isAuthenticated = true;\n        this.userData = JSON.parse(localStorage.getItem('userData')) || {}; // Retrieve user data\n      }\n    },\n    async login(credentials) {\n      this.errorMessage = '';\n      try {\n        const response = await axios__WEBPACK_IMPORTED_MODULE_4__[\"default\"].post('/wp-json/vueapp/v1/login', credentials, {\n          withCredentials: true\n          // headers: {\n          //   'X-WP-Nonce': window.oplbaseNonce, // Use the same nonce as registration\n          // },\n        });\n        console.log('Login response:', response.data);\n\n        // Check if the login was unsuccessful\n        if (!response.data.success) {\n          // Manually handle the error\n          this.handleError({\n            response: {\n              data: {\n                message: response.data.message\n              }\n            }\n          });\n          return;\n        }\n        this.isAuthenticated = true;\n        this.userData = response.data.user || {};\n        localStorage.removeItem('appState'); // refresh app state on login\n        localStorage.setItem('isAuthenticated', 'true'); // Save to local storage\n        localStorage.setItem('userData', JSON.stringify(this.userData)); // Save user data\n\n        // Fetch user data\n        await this.fetchUserData(response.data.user.id);\n\n        // router.push('/actionplan')\n      } catch (error) {\n        this.handleError(error);\n      }\n    },\n    async fetchUserData(userId) {\n      const selectionStore = (0,_frontend_stores_selectionStore_js__WEBPACK_IMPORTED_MODULE_2__.useSelectionStore)();\n      await selectionStore.fetchFromWordPress(userId, this.metaKey);\n    },\n    setUser(data) {\n      this.userData = data;\n    },\n    async logout() {\n      try {\n        // Call WordPress logout endpoint\n        await axios__WEBPACK_IMPORTED_MODULE_4__[\"default\"].post('/wp-json/vueapp/v1/logout');\n\n        // Clear local session\n        this.isAuthenticated = false;\n        this.userData = {};\n        localStorage.removeItem('isAuthenticated');\n        localStorage.removeItem('userData');\n        localStorage.removeItem('appState');\n\n        // Redirect to home\n        _frontend_router_index_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].push('/');\n      } catch (error) {\n        console.error('Logout Error:', error);\n        // Handle any errors here\n      }\n    },\n    handleError(error) {\n      this.isAuthenticated = false;\n      // Set a user-friendly error message\n      if (error.response) {\n        // The request was made and the server responded with a status code\n        // that falls out of the range of 2xx\n        this.errorMessage = error.response.data.message || 'Login failed. Please try again.';\n      } else if (error.request) {\n        // The request was made but no response was received\n        this.errorMessage = 'No response from server. Check your network connection.';\n      } else {\n        // Something happened in setting up the request that triggered an Error\n        this.errorMessage = 'Error: ' + error.message;\n      }\n    }\n  }\n});\n\n//# sourceURL=webpack://three/./src/frontend/stores/userStore.js?");

/***/ })

});